name: Publish

on:
  push:
    tags:
      - '*' 

  workflow_dispatch: {}

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          fetch-tags: true

      - name: Get tag SHA
        run: |
          TAG=${GITHUB_REF#refs/tags/}
          echo "$TAG"
          URL="https://github.com/alienengineer/is-my-code-great/archive/$TAG.tar.gz"
          echo "$URL"
          curl -LJO $URL
          FILE="is-my-code-great-${TAG#v}.tar.gz"
          SHA=$(shasum -a256 $FILE | awk '{print $1}')
          echo $SHA
          echo "sha256=$SHA" >> $GITHUB_ENV
          
